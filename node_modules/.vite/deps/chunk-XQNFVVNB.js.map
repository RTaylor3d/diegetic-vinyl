{
  "version": 3,
  "sources": ["../../music-metadata/lib/id3v2/AbstractID3Parser.js"],
  "sourcesContent": ["import { EndOfStreamError } from 'strtok3';\r\nimport initDebug from 'debug';\r\nimport { ID3v2Header } from './ID3v2Token.js';\r\nimport { ID3v2Parser } from './ID3v2Parser.js';\r\nimport { ID3v1Parser } from '../id3v1/ID3v1Parser.js';\r\nimport { BasicParser } from '../common/BasicParser.js';\r\nconst debug = initDebug('music-metadata:parser:ID3');\r\n/**\r\n * Abstract parser which tries take ID3v2 and ID3v1 headers.\r\n */\r\nexport class AbstractID3Parser extends BasicParser {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.id3parser = new ID3v2Parser();\r\n    }\r\n    static async startsWithID3v2Header(tokenizer) {\r\n        return (await tokenizer.peekToken(ID3v2Header)).fileIdentifier === 'ID3';\r\n    }\r\n    async parse() {\r\n        try {\r\n            await this.parseID3v2();\r\n        }\r\n        catch (err) {\r\n            if (err instanceof EndOfStreamError) {\r\n                debug(\"End-of-stream\");\r\n            }\r\n            else {\r\n                throw err;\r\n            }\r\n        }\r\n    }\r\n    finalize() {\r\n        return;\r\n    }\r\n    async parseID3v2() {\r\n        await this.tryReadId3v2Headers();\r\n        debug('End of ID3v2 header, go to MPEG-parser: pos=%s', this.tokenizer.position);\r\n        await this.postId3v2Parse();\r\n        if (this.options.skipPostHeaders && this.metadata.hasAny()) {\r\n            this.finalize();\r\n        }\r\n        else {\r\n            const id3v1parser = new ID3v1Parser(this.metadata, this.tokenizer, this.options);\r\n            await id3v1parser.parse();\r\n            this.finalize();\r\n        }\r\n    }\r\n    async tryReadId3v2Headers() {\r\n        const id3Header = await this.tokenizer.peekToken(ID3v2Header);\r\n        if (id3Header.fileIdentifier === 'ID3') {\r\n            debug('Found ID3v2 header, pos=%s', this.tokenizer.position);\r\n            await this.id3parser.parse(this.metadata, this.tokenizer, this.options);\r\n            return this.tryReadId3v2Headers();\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=AbstractID3Parser.js.map"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;AACA,mBAAsB;AAKtB,IAAM,YAAQ,aAAAA,SAAU,2BAA2B;AAI5C,IAAM,oBAAN,cAAgC,YAAY;AAAA,EAC/C,cAAc;AACV,UAAM,GAAG,SAAS;AAClB,SAAK,YAAY,IAAI,YAAY;AAAA,EACrC;AAAA,EACA,aAAa,sBAAsB,WAAW;AAC1C,YAAQ,MAAM,UAAU,UAAU,WAAW,GAAG,mBAAmB;AAAA,EACvE;AAAA,EACA,MAAM,QAAQ;AACV,QAAI;AACA,YAAM,KAAK,WAAW;AAAA,IAC1B,SACO,KAAK;AACR,UAAI,eAAe,kBAAkB;AACjC,cAAM,eAAe;AAAA,MACzB,OACK;AACD,cAAM;AAAA,MACV;AAAA,IACJ;AAAA,EACJ;AAAA,EACA,WAAW;AACP;AAAA,EACJ;AAAA,EACA,MAAM,aAAa;AACf,UAAM,KAAK,oBAAoB;AAC/B,UAAM,kDAAkD,KAAK,UAAU,QAAQ;AAC/E,UAAM,KAAK,eAAe;AAC1B,QAAI,KAAK,QAAQ,mBAAmB,KAAK,SAAS,OAAO,GAAG;AACxD,WAAK,SAAS;AAAA,IAClB,OACK;AACD,YAAM,cAAc,IAAI,YAAY,KAAK,UAAU,KAAK,WAAW,KAAK,OAAO;AAC/E,YAAM,YAAY,MAAM;AACxB,WAAK,SAAS;AAAA,IAClB;AAAA,EACJ;AAAA,EACA,MAAM,sBAAsB;AACxB,UAAM,YAAY,MAAM,KAAK,UAAU,UAAU,WAAW;AAC5D,QAAI,UAAU,mBAAmB,OAAO;AACpC,YAAM,8BAA8B,KAAK,UAAU,QAAQ;AAC3D,YAAM,KAAK,UAAU,MAAM,KAAK,UAAU,KAAK,WAAW,KAAK,OAAO;AACtE,aAAO,KAAK,oBAAoB;AAAA,IACpC;AAAA,EACJ;AACJ;",
  "names": ["initDebug"]
}
